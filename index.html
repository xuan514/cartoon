<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ConvertCartoon</title>
<style>
    body {
        margin: 0;
        padding: 0;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: #f0f0f0;
    }
    .title {
        font-size: 24px;
        margin-top: 20px;
    }
    .container {
        width: 1024px;
        display: flex;
        flex-wrap: wrap; /* 允許彈性布局換行 */
        justify-content: space-between;
        margin-top: 20px;
    }
    .upload-box{
        width: 48%;
        height: 350px;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        border: 1px solid #ccc;
        background-color: #fff;
        margin-bottom: 5px;
        padding: 5px;
    }
    .download-box {
        width: 48%;
        height: 300px;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        border: 1px solid #ccc;
        background-color: #fff;
        padding: 5px;
    }
    .upload-box img,
    .upload-box video {
        max-width: 100%; /* 不超出box */
        display: block; /* 讓圖片和視頻置中 */
        margin: 0 auto; /* 水平置中 */
    }
    form{
       margin: 10px; 
    }
    input[type='file'],input[type='submit'],input[type='reset'],#imagelabel,#videolabel{
        cursor: pointer;
    }
</style>
</head>
<body>

<div class="title">風格轉換生成器</div>

<div class="container">
    <div class="upload-box">
        <div>圖片預覽</div>
        <form id="imageform" enctype="multipart/form-data" method="post" >
            <img id="imagePreview" src="#" alt="Preview" style="width: auto; height: 250px; display: none;"><br>
            <label id="imagelabel" for="imageUpload">+ 點擊選擇圖片</label>
            <input type="file" id="imageUpload" accept="image/*" style="display: none;">
            <span id="file-name"></span>
            <input type="reset" id="imageResetBtn" value="重選" style="display: none;">
            <input type="submit" id="imageConvertBtn" value="轉換" style="display: none;">
        </form>
    </div>
    <div class="upload-box">
        <div>影片預覽</div>
        <form id="videoform" enctype="multipart/form-data" method="post"  >
            <video id="videoPreview" controls style="width: auto; height: 240px; display: none;">
                <source src="#" type="video/mp4">
                瀏覽器沒有支援影片播放!
            </video><br>
            <label id="videolabel" for="videoUpload">+ 點擊選擇影片</label>
            <input type="file" id="videoUpload" accept="video/*" style="display: none;">
            <span id="video-file-name"></span>
            <input type="reset" id="videoResetBtn" value="重選" style="display: none;">
            <input type="submit" id="videoConvertBtn" value="轉換" style="display: none;">
        </form>
    </div>
    <div class="download-box">
        <div>轉換結果</div>
        <img id="convertedImg" src="#" alt="Converted Image" style="width: auto; height: 250px; display: none;"><br>
        <a id="downloadBtn" href="#" download="converted_image.jpg" style="display: none;">下載轉換後圖片</a>
    </div>
    <div class="download-box">
        <div>轉換結果</div>
        
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.12.0/dist/tf.min.js"></script>
<script>
    const imageUpload = document.getElementById('imageUpload');
    const imagePreview = document.getElementById('imagePreview');
    const imageLabel = document.getElementById('imagelabel');
    const imageFileName = document.getElementById('file-name');
    const imageResetBtn = document.getElementById('imageResetBtn');
    const imageConvertBtn = document.getElementById('imageConvertBtn');
    const imageForm = document.getElementById('imageform');
    // 圖片預覽
    imageUpload.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            // 顯示檔案名稱
            imageFileName.innerText = file.name;

            imageLabel.style.display = 'none';
            imageResetBtn.style.display = 'inline-block';
            imageConvertBtn.style.display = 'inline-block';
            // 顯示預覽圖片
            const reader = new FileReader();
            reader.onload = function() {
                imagePreview.src = reader.result;
                imagePreview.style.display = 'block';
            }
            reader.readAsDataURL(file);
        }else{
            // 如果沒有選擇文件，隱藏預覽和檔案名稱
            imagePreview.style.display = 'none';
            imageFileName.innerText = '';
            imageResetBtn.style.display = 'none';
            imageConvertBtn.style.display = 'none';
        }
    });
    // 圖片重選
    imageResetBtn.addEventListener('click', function() {
        imageUpload.value = ''; // 清除已選擇的文件
        imageFileName.innerText = ''; // 清除檔案名稱

        imagePreview.style.display = 'none'; 
        this.style.display = 'none'; 
        imageConvertBtn.style.display = 'none';
        imageLabel.style.display = 'inline-block';
    });
    // 圖片轉換
    document.addEventListener("DOMContentLoaded", function() {
        const imageConvertBtn = document.getElementById("imageConvertBtn");
    
        imageConvertBtn.addEventListener("click", async function() {
            const file = document.getElementById("imageUpload").files[0];
    
            if (!file) {
                alert("請選擇圖片文件");
                return;
            }
    
            // 將文件轉換為 TensorFlow.js 可用的格式
            const imageTensor = await fileToTensor(file);
    
            // 處理圖片轉換的過程
            const transformedImage = await processImage(imageTensor);
    
            // 顯示轉換結果
            displayImage(transformedImage);
        });
    
        // 將文件轉換為 TensorFlow.js 可用的格式
        async function fileToTensor(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const image = new Image();
                    image.onload = () => {
                        const tensor = tf.browser.fromPixels(image);
                        resolve(tensor);
                    };
                    image.onerror = (error) => {
                        reject(error);
                    };
                    image.src = event.target.result;
                };
                reader.readAsDataURL(file);
            });
        }
    
        // 處理圖片轉換的過程
        async function processImage(imageTensor) {
            // 在這裡使用 TensorFlow.js 的 API 進行圖片轉換
            // 這裡省略轉換過程，假設 transformedImage 為轉換後的圖片張量
            const transformedImage = imageTensor; // 假設轉換後的圖片張量就是原始圖片張量
            return transformedImage;
        }
    
        // 顯示轉換結果
        function displayImage(imageTensor) {
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");
            const imageData = new ImageData(imageTensor.shape[0], imageTensor.shape[1]);
    
            tf.browser.toPixels(imageTensor, imageData.data)
                .then(() => {
                    canvas.width = imageTensor.shape[0];
                    canvas.height = imageTensor.shape[1];
                    ctx.putImageData(imageData, 0, 0);
                    document.body.appendChild(canvas);
                })
                .catch((error) => {
                    console.error("Failed to display image:", error);
                });
        }
    });

    const videoUpload = document.getElementById('videoUpload');
    const videoPreview = document.getElementById('videoPreview');
    const videoLabel = document.getElementById('videolabel');
    const videoFileName = document.getElementById('video-file-name');
    const videoResetBtn = document.getElementById('videoResetBtn');
    const videoConvertBtn = document.getElementById('videoConvertBtn');
    const videoForm = document.getElementById('videoform');
    // 影片預覽
    videoUpload.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            // 顯示檔案名稱
            videoFileName.innerText = file.name;
            // 顯示重選按鈕
            videoLabel.style.display = 'none';
            videoResetBtn.style.display = 'inline-block';
            videoConvertBtn.style.display = 'inline-block';
            // 顯示預覽影片
            const reader = new FileReader();
            reader.onload = function() {
                videoPreview.src = reader.result;
                videoPreview.style.display = 'block';
            }
            reader.readAsDataURL(file);
        }else {
            // 如果沒有選擇文件，隱藏預覽和檔案名稱
            videoPreview.style.display = 'none';
            videoFileName.innerText = '';
            // 隱藏重選按鈕
            videoResetBtn.style.display = 'none';
            videoConvertBtn.style.display = 'none';
        }
    });
     // 影片重選
     videoResetBtn.addEventListener('click', function() {
        videoUpload.value = ''; // 清除已選擇的文件
        videoFileName.innerText = ''; // 清除檔案名稱
        videoPreview.style.display = 'none'; // 隱藏預覽影片
        this.style.display = 'none'; // 隱藏重選按鈕
        videoConvertBtn.style.display = 'none';
        videoLabel.style.display = 'inline-block';
    });
    // 檔案轉換
    videoForm.addEventListener('submit', function(event) {
        
    });

</script>

</body>
</html>
